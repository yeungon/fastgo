<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triple Server Comparison Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: rgba(255, 255, 255, 0.6);
            margin-top: 10px;
        }

        .server-comparison {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1400px) {
            .server-comparison {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 900px) {
            .server-comparison {
                grid-template-columns: 1fr;
            }
        }

        .server-panel {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 15px;
        }

        .server-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .server-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .server-title.worker {
            color: #00d4ff;
        }

        .server-title.chi {
            color: #f97316;
        }

        .server-title.fiber {
            color: #10b981;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 0.7rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }

        .status-dot.disconnected {
            background: #ef4444;
            animation: none;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }

        .metric-card .label {
            font-size: 0.6rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .metric-card .value {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .metric-card .value.worker {
            color: #00d4ff;
        }

        .metric-card .value.chi {
            color: #f97316;
        }

        .metric-card .value.fiber {
            color: #10b981;
        }

        .metric-card .unit {
            font-size: 0.6rem;
            color: rgba(255, 255, 255, 0.4);
        }

        .comparison-charts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        @media (max-width: 1200px) {
            .comparison-charts {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 800px) {
            .comparison-charts {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 15px;
        }

        .chart-card h3 {
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
        }

        .chart-card .chart-wrapper {
            height: 180px;
        }

        .server-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.6rem;
            font-weight: 600;
            margin-left: 6px;
        }

        .server-badge.worker {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }

        .server-badge.chi {
            background: rgba(249, 115, 22, 0.2);
            color: #f97316;
        }

        .server-badge.fiber {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .port-info {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.7rem;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>üöÄ Triple Server Comparison</h1>
        <p>Worker Pool (FastHTTP) vs Chi (net/http) vs Fiber (FastHTTP) - Real-time Comparison</p>
    </div>

    <div class="server-comparison">
        <!-- Worker Pool Server (Port 8080) -->
        <div class="server-panel">
            <div class="server-header">
                <div class="server-title worker">‚ö° Worker Pool</div>
                <div class="status">
                    <span class="status-dot" id="statusDot1"></span>
                    <span id="statusText1">Connecting...</span>
                </div>
            </div>
            <p class="port-info">Port 8080 | FastHTTP | Worker Pool Pattern</p>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="label">Active</div>
                    <div class="value worker" id="active1">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">RPS</div>
                    <div class="value worker" id="rps1">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">Memory</div>
                    <div class="value worker" id="memory1">0</div>
                    <div class="unit">MB</div>
                </div>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="label">CPU</div>
                    <div class="value worker" id="cpu1">0</div>
                    <div class="unit">%</div>
                </div>
                <div class="metric-card">
                    <div class="label">Goroutines</div>
                    <div class="value worker" id="goroutines1">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">Errors</div>
                    <div class="value worker" id="errors1">0</div>
                </div>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="label">Heap</div>
                    <div class="value worker" id="heap1">0</div>
                    <div class="unit">MB</div>
                </div>
                <div class="metric-card">
                    <div class="label">GC</div>
                    <div class="value worker" id="gc1">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">Uptime</div>
                    <div class="value worker" id="uptime1">0</div>
                    <div class="unit">sec</div>
                </div>
            </div>
        </div>

        <!-- Chi Web Server (Port 8081) -->
        <div class="server-panel">
            <div class="server-header">
                <div class="server-title chi">üåê Chi Web</div>
                <div class="status">
                    <span class="status-dot" id="statusDot2"></span>
                    <span id="statusText2">Connecting...</span>
                </div>
            </div>
            <p class="port-info">Port 8081 | net/http | Standard Go HTTP</p>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="label">Active</div>
                    <div class="value chi" id="active2">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">RPS</div>
                    <div class="value chi" id="rps2">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">Memory</div>
                    <div class="value chi" id="memory2">0</div>
                    <div class="unit">MB</div>
                </div>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="label">CPU</div>
                    <div class="value chi" id="cpu2">0</div>
                    <div class="unit">%</div>
                </div>
                <div class="metric-card">
                    <div class="label">Goroutines</div>
                    <div class="value chi" id="goroutines2">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">Errors</div>
                    <div class="value chi" id="errors2">0</div>
                </div>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="label">Heap</div>
                    <div class="value chi" id="heap2">0</div>
                    <div class="unit">MB</div>
                </div>
                <div class="metric-card">
                    <div class="label">GC</div>
                    <div class="value chi" id="gc2">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">Uptime</div>
                    <div class="value chi" id="uptime2">0</div>
                    <div class="unit">sec</div>
                </div>
            </div>
        </div>

        <!-- Fiber Server (Port 8082) -->
        <div class="server-panel">
            <div class="server-header">
                <div class="server-title fiber">üî• Fiber</div>
                <div class="status">
                    <span class="status-dot" id="statusDot3"></span>
                    <span id="statusText3">Connecting...</span>
                </div>
            </div>
            <p class="port-info">Port 8082 | FastHTTP | Express-like API</p>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="label">Active</div>
                    <div class="value fiber" id="active3">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">RPS</div>
                    <div class="value fiber" id="rps3">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">Memory</div>
                    <div class="value fiber" id="memory3">0</div>
                    <div class="unit">MB</div>
                </div>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="label">CPU</div>
                    <div class="value fiber" id="cpu3">0</div>
                    <div class="unit">%</div>
                </div>
                <div class="metric-card">
                    <div class="label">Goroutines</div>
                    <div class="value fiber" id="goroutines3">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">Errors</div>
                    <div class="value fiber" id="errors3">0</div>
                </div>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="label">Heap</div>
                    <div class="value fiber" id="heap3">0</div>
                    <div class="unit">MB</div>
                </div>
                <div class="metric-card">
                    <div class="label">GC</div>
                    <div class="value fiber" id="gc3">0</div>
                </div>
                <div class="metric-card">
                    <div class="label">Uptime</div>
                    <div class="value fiber" id="uptime3">0</div>
                    <div class="unit">sec</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparison Charts -->
    <div class="comparison-charts">
        <div class="chart-card">
            <h3>üìà Requests Per Second<span class="server-badge worker">Worker</span><span
                    class="server-badge chi">Chi</span><span class="server-badge fiber">Fiber</span></h3>
            <div class="chart-wrapper"><canvas id="rpsChart"></canvas></div>
        </div>
        <div class="chart-card">
            <h3>üîó Active Connections<span class="server-badge worker">Worker</span><span
                    class="server-badge chi">Chi</span><span class="server-badge fiber">Fiber</span></h3>
            <div class="chart-wrapper"><canvas id="connectionsChart"></canvas></div>
        </div>
        <div class="chart-card">
            <h3>üíæ Memory Usage<span class="server-badge worker">Worker</span><span
                    class="server-badge chi">Chi</span><span class="server-badge fiber">Fiber</span></h3>
            <div class="chart-wrapper"><canvas id="memoryChart"></canvas></div>
        </div>
        <div class="chart-card">
            <h3>üßµ Goroutines<span class="server-badge worker">Worker</span><span
                    class="server-badge chi">Chi</span><span class="server-badge fiber">Fiber</span></h3>
            <div class="chart-wrapper"><canvas id="goroutinesChart"></canvas></div>
        </div>
        <div class="chart-card">
            <h3>üî• CPU Usage<span class="server-badge worker">Worker</span><span
                    class="server-badge chi">Chi</span><span class="server-badge fiber">Fiber</span></h3>
            <div class="chart-wrapper"><canvas id="cpuChart"></canvas></div>
        </div>
        <div class="chart-card">
            <h3>üóëÔ∏è GC Pause Time<span class="server-badge worker">Worker</span><span
                    class="server-badge chi">Chi</span><span class="server-badge fiber">Fiber</span></h3>
            <div class="chart-wrapper"><canvas id="gcChart"></canvas></div>
        </div>
    </div>

    <script>
        // Server data storage
        let server1Data = {};
        let server2Data = {};
        let server3Data = {};

        // Utility functions
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function formatUptime(seconds) {
            if (seconds < 60) return Math.floor(seconds) + 's';
            if (seconds < 3600) return Math.floor(seconds / 60) + 'm';
            return Math.floor(seconds / 3600) + 'h';
        }

        // Chart creation with 3 datasets
        function createTripleChart(ctx, label1, label2, label3) {
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: label1,
                        data: [],
                        borderColor: '#00d4ff',
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointRadius: 0
                    }, {
                        label: label2,
                        data: [],
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointRadius: 0
                    }, {
                        label: label3,
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { color: 'rgba(255,255,255,0.7)', boxWidth: 12, font: { size: 10 } }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: 'rgba(255,255,255,0.5)', maxTicksLimit: 6, font: { size: 9 } }
                        },
                        y: {
                            display: true,
                            beginAtZero: true,
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: 'rgba(255,255,255,0.5)', font: { size: 9 } }
                        }
                    },
                    animation: { duration: 0 }
                }
            });
        }

        function addTripleData(chart, label, value1, value2, value3) {
            const maxPoints = 60;
            chart.data.labels.push(label);
            chart.data.datasets[0].data.push(value1);
            chart.data.datasets[1].data.push(value2);
            chart.data.datasets[2].data.push(value3);

            if (chart.data.labels.length > maxPoints) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
                chart.data.datasets[1].data.shift();
                chart.data.datasets[2].data.shift();
            }
            chart.update('none');
        }

        // Initialize charts
        const rpsChart = createTripleChart(document.getElementById('rpsChart').getContext('2d'), 'Worker Pool', 'Chi Web', 'Fiber');
        const connectionsChart = createTripleChart(document.getElementById('connectionsChart').getContext('2d'), 'Worker Pool', 'Chi Web', 'Fiber');
        const memoryChart = createTripleChart(document.getElementById('memoryChart').getContext('2d'), 'Worker Pool', 'Chi Web', 'Fiber');
        const goroutinesChart = createTripleChart(document.getElementById('goroutinesChart').getContext('2d'), 'Worker Pool', 'Chi Web', 'Fiber');
        const cpuChart = createTripleChart(document.getElementById('cpuChart').getContext('2d'), 'Worker Pool', 'Chi Web', 'Fiber');
        const gcChart = createTripleChart(document.getElementById('gcChart').getContext('2d'), 'Worker Pool', 'Chi Web', 'Fiber');

        // Update server metrics display
        function updateServerMetrics(serverId, data) {
            const suffix = serverId;
            document.getElementById('active' + suffix).textContent = data.active_connections || 0;
            document.getElementById('rps' + suffix).textContent = (data.requests_per_sec || 0).toFixed(1);
            document.getElementById('memory' + suffix).textContent = (data.memory_alloc_mb || 0).toFixed(1);
            document.getElementById('cpu' + suffix).textContent = (data.cpu_usage_percent || 0).toFixed(1);
            document.getElementById('goroutines' + suffix).textContent = data.num_goroutines || 0;
            document.getElementById('errors' + suffix).textContent = formatNumber(data.error_count || 0);
            document.getElementById('heap' + suffix).textContent = (data.memory_heap_mb || 0).toFixed(1);
            document.getElementById('gc' + suffix).textContent = data.num_gc || 0;
            document.getElementById('uptime' + suffix).textContent = formatUptime(data.uptime_seconds || 0);
        }

        function setConnectionStatus(serverId, connected) {
            const statusDot = document.getElementById('statusDot' + serverId);
            const statusText = document.getElementById('statusText' + serverId);
            if (connected) {
                statusDot.classList.remove('disconnected');
                statusText.textContent = 'Connected';
            } else {
                statusDot.classList.add('disconnected');
                statusText.textContent = 'Reconnecting...';
            }
        }

        function updateCharts() {
            const timeLabel = new Date().toLocaleTimeString();
            addTripleData(rpsChart, timeLabel, server1Data.requests_per_sec || 0, server2Data.requests_per_sec || 0, server3Data.requests_per_sec || 0);
            addTripleData(connectionsChart, timeLabel, server1Data.active_connections || 0, server2Data.active_connections || 0, server3Data.active_connections || 0);
            addTripleData(memoryChart, timeLabel, server1Data.memory_alloc_mb || 0, server2Data.memory_alloc_mb || 0, server3Data.memory_alloc_mb || 0);
            addTripleData(goroutinesChart, timeLabel, server1Data.num_goroutines || 0, server2Data.num_goroutines || 0, server3Data.num_goroutines || 0);
            addTripleData(cpuChart, timeLabel, server1Data.cpu_usage_percent || 0, server2Data.cpu_usage_percent || 0, server3Data.cpu_usage_percent || 0);
            addTripleData(gcChart, timeLabel, server1Data.gc_pause_last_ms || 0, server2Data.gc_pause_last_ms || 0, server3Data.gc_pause_last_ms || 0);
        }

        // Connect to Worker Pool server (8080)
        function connectServer1() {
            const baseUrl = window.location.hostname;
            const eventSource = new EventSource(`http://${baseUrl}:8080/sse/metrics`);
            eventSource.onopen = () => { console.log('Server 1 (Worker Pool) connected'); setConnectionStatus(1, true); };
            eventSource.onmessage = (event) => {
                try { server1Data = JSON.parse(event.data); updateServerMetrics(1, server1Data); }
                catch (e) { console.error('Error parsing Server 1 data:', e); }
            };
            eventSource.onerror = () => {
                console.error('Server 1 connection error');
                setConnectionStatus(1, false);
                eventSource.close();
                setTimeout(connectServer1, 3000);
            };
        }

        // Connect to Chi server (8081)
        function connectServer2() {
            const baseUrl = window.location.hostname;
            const eventSource = new EventSource(`http://${baseUrl}:8081/sse/metrics`);
            eventSource.onopen = () => { console.log('Server 2 (Chi Web) connected'); setConnectionStatus(2, true); };
            eventSource.onmessage = (event) => {
                try { server2Data = JSON.parse(event.data); updateServerMetrics(2, server2Data); }
                catch (e) { console.error('Error parsing Server 2 data:', e); }
            };
            eventSource.onerror = () => {
                console.error('Server 2 connection error');
                setConnectionStatus(2, false);
                eventSource.close();
                setTimeout(connectServer2, 3000);
            };
        }

        // Connect to Fiber server (8082)
        function connectServer3() {
            const baseUrl = window.location.hostname;
            const eventSource = new EventSource(`http://${baseUrl}:8082/sse/metrics`);
            eventSource.onopen = () => { console.log('Server 3 (Fiber) connected'); setConnectionStatus(3, true); };
            eventSource.onmessage = (event) => {
                try { server3Data = JSON.parse(event.data); updateServerMetrics(3, server3Data); }
                catch (e) { console.error('Error parsing Server 3 data:', e); }
            };
            eventSource.onerror = () => {
                console.error('Server 3 connection error');
                setConnectionStatus(3, false);
                eventSource.close();
                setTimeout(connectServer3, 3000);
            };
        }

        // Start connections
        connectServer1();
        connectServer2();
        connectServer3();

        // Update charts every second
        setInterval(updateCharts, 1000);
    </script>
</body>

</html>